# å·¥ä½œæµåç§°
name: è‡ªåŠ¨æ›´æ–° index.html

# è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç  push åˆ° main åˆ†æ”¯æ—¶ï¼ˆåˆ†æ”¯åæ ¹æ®å®é™…ä¿®æ”¹ï¼Œå¦‚ masterï¼‰
on:
  push:
    branches: [ main ]
    # ä»…å½“ç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆcode-note ç­‰ï¼‰æˆ–è„šæœ¬æ–‡ä»¶å˜åŒ–æ—¶è§¦å‘ï¼ˆé¿å…ä¸å¿…è¦çš„è¿è¡Œï¼‰
    paths:
      - 'code-note/**'  # ç›‘æ§ code-note ä¸‹æ‰€æœ‰æ–‡ä»¶
      - 'generate_index.py'  # ç›‘æ§è„šæœ¬æ–‡ä»¶
      - '.github/workflows/update-index.yml'  # ç›‘æ§å·¥ä½œæµæ–‡ä»¶

# å·¥ä½œæµä»»åŠ¡
jobs:
  update-index:
    runs-on: ubuntu-latest  # ä½¿ç”¨ Ubuntu ç³»ç»Ÿè¿è¡Œ
    
    steps:
      # æ­¥éª¤ 1ï¼šæ£€å‡º GitHub ä»“åº“ä»£ç 
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # ä¿æŒå…³é—­é»˜è®¤å‡­è¯
          token: ${{ secrets.WORKFLOW_PUSH }}  # å¼•ç”¨å­˜å‚¨çš„ PAT å‡­è¯
          fetch-depth: 0  # ï¼ˆå¯é€‰ï¼‰ç¡®ä¿è·å–å®Œæ•´çš„æäº¤å†å²ï¼Œé¿å… push æ—¶å†²çª
    
      # æ­¥éª¤ 2ï¼šå®‰è£… Pythonï¼ˆè¿è¡Œç”Ÿæˆè„šæœ¬éœ€è¦ï¼‰
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # é€‰æ‹©åˆé€‚çš„ Python ç‰ˆæœ¬
    
      # æ­¥éª¤ 3ï¼šè¿è¡Œè„šæœ¬ç”Ÿæˆ index.html
      - name: ç”Ÿæˆ index.html
        run: python generate_index.py  # æ‰§è¡Œè„šæœ¬
    
      # æ­¥éª¤ 4ï¼šæäº¤æ›´æ–°åçš„ index.html åˆ°ä»“åº“
      - name: æäº¤ index.html æ›´æ–°
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # è¦æäº¤çš„æ–‡ä»¶ï¼ˆä»… index.htmlï¼‰
          file_pattern: 'index.html'
          # æäº¤ä¿¡æ¯
          commit_message: 'ğŸ”„ è‡ªåŠ¨æ›´æ–° index.htmlï¼ˆç”± GitHub Actions è§¦å‘ï¼‰'
          # æäº¤è€…ä¿¡æ¯ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'actions@github.com'